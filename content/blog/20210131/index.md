---
title: AWS Web Services 基礎からのネットワーク＆サーバー構築 Chapter3
date: 2021-01-31
tags: ["AWS"]
---

[Kindle](AWS Web Services 基礎からのネットワーク＆サーバー構築)

## Chapter3 サーバーを構築する

1. 仮想サーバーを構築する

- AmazonEC2 で構築した仮想サーバーのことをインスタンスと呼ぶ
- 作成したインスタンスには「VPC 内で通信するためのプライベート IP アドレス」と「インターネットで通信するためのパブリック IP アドレス」の 2 つを持つ

2. SSH で接続する

- Tera Term でパブリック IP アドレスから接続

3. IP アドレスとポート番号

- ルーターに新たにネットワークを追加した場合、そのネットワークの情報をルートテーブルに追加する必要がある
- さらにネットワークを追加したルーターに接続されているルーターのルートテーブルにも情報を追加したネットワークを見る場合には情報を追加する必要がある
- インターネットではルーター同士が通信してルートテーブルの情報をやり取りし、必要に応じて自動的に更新するようにしている
- これはルーティングプロトコルと呼ばれる仕組みで実現されていて、大きく分けて「EGP」と「IGP」という 2 つの種別に分けられている

  - EGP(Exterior Gateway Protocol)
    プロバイダーや AWS などのある程度大きなネットワークは AS 番号という番号を持っており、この番号をやり取りしてどのネットワークの先にどのネットワークが接続されているのかおおまかに判別している  
    ex. BGP
  - IGP(Interior Gateway Protocol)
    EGP の内部のルーター同士でルートテーブルの情報をやり取りする  
    ex. OSPF, RIP

- サーバー側では sshd というプログラムが動作しているため、SSH で接続することができる
- TCP/IP で通信するサーバーなどの機器には「他のコンピュータとデータを送受信するためのデータの出入口」が用意されており、これを「ポート」と言う
- ポートには「相手にデータが届いたことを保障する TCP」と「確認せずに送信する UDP」が存在する
- 代表的なアプリケーションが使用するポートはウェルノウンポートと呼ばれ、明示的に指定しなければ自動的に使用される(SSH=22, SMTP=25, HTTP=80, HTTPS=443 など)
- データを送信する際にはサーバーと同様にクライアント側にもポートが必要で、このクライアントのポートはランダムな番号を一時的に使用し、サーバーとの通信終了時には解放される。これをエフェメラルポートと呼び、サーバーからクライアントにデータを送る際にも同様の仕組みが使用される

4. ファイアウォールで接続制限をする

- ファイアウォールとは「通して良いデータだけを通して、それ以外を遮断する機能の総称」
  - パケットフィルタリング  
    流れるパケットを見て通過の可否を決める仕組み。IP アドレスやポート番号などパケットに付随する各種情報を見て通過の可否を決める  
    AWS ではセキュリティグループからパケットフィルタリングを設定する
